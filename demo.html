<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ElementCapture Demo</title>
	<style>
		body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height: 1.5; padding: 24px; }
		button { padding: 8px 12px; font-size: 14px; }
		.grid { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 12px; margin-top: 16px; }
		.card { border: 1px solid #ddd; padding: 12px; border-radius: 6px; }
		.card a { color: #0a58ca; text-decoration: underline; }
	</style>
</head>
<body>
	<h1>ElementCapture Demo</h1>
	<p>Click the button to start capture mode, then click anywhere; the element will be logged in the console. The explanation will also be logged if an API key is provided in the URL.</p>
	<p><strong>Tip:</strong> Press Esc to cancel capture.</p>

	<button id="start-capture">Start capture</button>
	<button id="stop-capture">Stop capture</button>

	<div class="grid">
		<div class="card">
			<h3>Card One</h3>
			<p>This is a <a href="#card1">link</a> inside a card.</p>
			<button>Card button</button>
		</div>
		<div class="card">
			<h3>Card Two</h3>
			<p>Another <a href="#card2">example link</a> to test default prevention.</p>
			<form action="#submit" onsubmit="console.log('form submitted (should be prevented in capture)'); return true;">
				<input placeholder="Type here" />
				<button type="submit">Submit</button>
			</form>
		</div>
		<div class="card">
			<h3>Card Three</h3>
			<label><input type="checkbox" /> Check me</label>
			<select>
				<option>One</option>
				<option>Two</option>
			</select>
		</div>
	</div>

	<script src="./element-intelligence.js"></script>
	<script>
		(function() {
			function getParam(name) {
				var params = new URLSearchParams(window.location.search);
				return params.get(name);
			}

			function getApiKeyFromUrl() {
				return getParam('api_key') || getParam('apikey') || getParam('apiKey') || getParam('key');
			}

			var apiKey = getApiKeyFromUrl();
			var appDescription = 'Demo shop: product cards, links, forms, and interactive controls to test element capture.';

			if (window.ElementInspector && typeof window.ElementInspector.configure === 'function') {
				window.ElementInspector.configure({ apiKey: apiKey || '', applicationDescription: appDescription });
			}

			document.getElementById('start-capture').addEventListener('click', function() {
				if (!window.ElementInspector) {
					console.warn('ElementInspector not available');
					return;
				}
				var hasKey = typeof apiKey === 'string' && apiKey.trim() !== '';
				if (!hasKey) {
					console.warn('No API key provided in URL. Only capturing element without explanation. Add ?api_key=YOUR_KEY to the URL.');
					window.ElementInspector.captureOnce().then(function(result) {
						console.log('Captured element:', result.element);
						console.log('Event type:', result.eventType);
					}).catch(function(err) {
						console.warn('Capture cancelled or stopped:', err && err.message);
					});
					return;
				}

				window.ElementInspector.captureAndExplain({ applicationDescription: appDescription }).then(function(out) {
					console.log('Captured element:', out.element);
					console.log('Event type:', out.eventType);
					if (out.result && out.result.ok) {
						console.log('[Explanation]', out.result.answerText);
					} else {
						console.warn('Explanation failed:', out.result && (out.result.message || out.result.code));
					}
				}).catch(function(err) {
					console.warn('Capture or explanation error:', err && err.message);
				});
			});

			document.getElementById('stop-capture').addEventListener('click', function() {
				if (window.ElementCapture) {
					window.ElementCapture.stop();
				}
			});
		})();
	</script>
</body>
</html>